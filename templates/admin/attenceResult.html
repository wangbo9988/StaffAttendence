{% load staticfiles %}
<!DOCTYPE html>
<!--[if lt IE 7]>

<html class="lt-ie9 lt-ie8 lt-ie7" lang="en">

<![endif]-->
<!--[if IE 7]>

<html class="lt-ie9 lt-ie8" lang="en">

<![endif]-->
<!--[if IE 8]>

<html class="lt-ie9" lang="en">

<![endif]-->
<!--[if gt IE 8]>
<!-->

<html lang="en">

<!--
<![endif]-->
<head>
    <meta charset="utf-8">
    <title>
        考勤系统-考勤记录
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- bootstrap css -->

    <link href="{% static "/icomoon/style.css" %}" rel="stylesheet">
    <link href="{% static "/css/main.css" %}" rel="stylesheet">
    <!-- Important. For Theming change primary-color variable in main.css  -->
    <link href="{% static "/css/alertify.core.css" %}" rel="stylesheet" id="toggleCSS">
    <!--[if lte IE 7]>
    <script src="static/css/icomoon-font/lte-ie7.js">
    </script>
    <![endif]-->

</head>
<body onload="message('success','跳转成功');">
<!-- 头部状态栏 start -->
<header>
    <a href="#" class="logo">
        <img src="{% static "/img/logo.png" %}" alt="Logo"/>
    </a>
    <div class="btn-group">
        <button class="btn btn-primary">
            早上好，admin ！
        </button>
        <button data-toggle="dropdown" class="btn btn-primary dropdown-toggle">
          <span class="caret">
          </span>
        </button>
        <ul class="dropdown-menu pull-right">
            <li>
                <a href="#myModal" role="button" data-toggle="modal">
                    修改密码
                </a>
            </li>
            <li>
                <a href="#">
                    注销账户
                </a>
            </li>
        </ul>
    </div>
</header>
<!-- 头部状态栏 end -->
<!-- 主体内容 start -->
<div class="container-fluid">
    <div class="dashboard-container">
        <!--头部主导航栏-->
        <div class="top-nav">
            <ul>
                <li>
                    <a href="/toEmployeeManage/">
                        <div class="fs1" aria-hidden="true" data-icon="&#xe072;"></div>
                        员工信息
                    </a>
                </li>
                <li>
                    <a href="/toLeaveRecord/">
                        <div class="fs1" aria-hidden="true" data-icon="&#xe0e4;"></div>
                        请假管理
                    </a>
                </li>
                <li>
                    <a href="/toResult/">
                        <div class="fs1" aria-hidden="true" data-icon="&#xe0b8;"></div>
                        考勤信息
                    </a>
                </li>
                </li>
                <li>
                    <a href="/toAttencrResult/" class="selected">
                        <div class="fs1" aria-hidden="true" data-icon="&#xe074;"></div>
                        考勤记录
                    </a>
                </li>
            </ul>
            <div class="clearfix">
            </div>
        </div>
        <!--头部副导航栏-->
        <div class="sub-nav">
            <ul>
                <li><a href="#" class="heading">考勤记录</a></li>
            </ul>
        </div>
        <div class="dashboard-wrapper">
            <div class="left-sidebar">

                <div class="row-fluid">

                    <div class="span12">
                        <!-- 员工信息 -->
                        <div class="widget">
                            <div class="widget-header">
                                <div class="title" id="list">
                                    考勤记录
                                </div>
                                <span class="tools">
                      <a class="fs1" aria-hidden="true" data-icon="" data-original-title=""></a>
                    </span>
                            </div>
                            <div class="widget-body">
                                <div id="dt_example" class="example_alt_pagination">
                                    <div id="data-table_wrapper" class="dataTables_wrapper" role="grid">
                                        <ul id="myTab" class="nav nav-tabs">
                                            <li class="active">
                                                <a href="#home" data-toggle="tab">
                                                    打卡记录
                                                </a>
                                            </li>
                                            <li><a href="#ios" data-toggle="tab">请假记录</a></li>
                                        </ul>
                                        <div id="myTabContent1" class="tab-content">
                                            <div class="tab-pane fade in active" id="home">
                                                <!-- 打卡记录 -->
                                                <table class="table table-condensed table-striped table-hover table-bordered pull-left dataTable"
                                                       id="data-table1" aria-describedby="data-table_info">

                                                    <thead>
                                                    <tr role="row">
                                                        <th>
                                                            记录编号
                                                        </th>
                                                        <th>
                                                            员工工号
                                                        </th>
                                                        <th>
                                                            员工姓名
                                                        </th>
                                                        <th>
                                                            上班打卡
                                                        </th>
                                                        <th>
                                                            下班打卡
                                                        </th>
                                                        <th>
                                                            所属部门
                                                        </th>
                                                        <th>
                                                            职位
                                                        </th>
                                                    </tr>
                                                    </thead>

                                                    <tbody id="table_on" role="alert" aria-live="polite"
                                                           aria-relevant="all">
                                                    </tbody>
                                                </table>
                                            </div>
                                            <div class="tab-pane fade" id="ios">
                                                <!-- 休假记录 -->
                                                <table class="table table-condensed table-striped table-hover table-bordered pull-left dataTable"
                                                       id="data-table2" aria-describedby="data-table_info">

                                                    <thead>
                                                    <tr role="row">
                                                        <th>
                                                            记录编号
                                                        </th>
                                                        <th>
                                                            员工工号
                                                        </th>
                                                        <th>
                                                            员工姓名
                                                        </th>
                                                        <th>
                                                            休假类型
                                                        </th>
                                                        <th>
                                                            开始时间
                                                        </th>
                                                        <th>
                                                            结束时间
                                                        </th>
                                                        <th>
                                                            所属部门
                                                        </th>
                                                        <th>
                                                            职位
                                                        </th>
                                                        <th>
                                                            审核情况
                                                        </th>
                                                        <th>
                                                            备注
                                                        </th>
                                                    </tr>
                                                    </thead>

                                                    <tbody id="table_off" role="alert" aria-live="polite"
                                                           aria-relevant="all">
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--/.fluid-container-->
</div>
<!-- 主体内容 end -->
<!-- 底部footer start -->
<footer>
    <p>
        &copy; XXX
    </p>
</footer>
<!-- 底部footer end -->


<script src="{% static "/js/jquery.min.js" %}">
</script>
<script src="{% static "/js/bootstrap.js" %}">
</script>
<script type="text/javascript" src="{% static "/js/alertify.min.js" %}">
</script>
<script src="{% static "/js/jquery.scrollUp.js" %}">
</script>
<script src="{% static "/js/jquery.dataTables.js" %}">
</script>
//主JS代码
<script type="text/javascript" src="{% static "/js/main.js" %}">
</script>
<script>
    /*
     * 页面加载自动执行方法
     * 注意加载顺序！
     * */

    //加载*在职*员工信息列表
    $(document).ready(function () {
        getEmployee_on();
    });
    //加载*离职*员工信息列表
    $(document).ready(function () {
        getEmployee_off();
    });

    //Data Tables插件
    $(document).ready(function () {
        $('#data-table1').dataTable({
            "sPaginationType": "full_numbers"
        });
    });
    $(document).ready(function () {
        $('#data-table2').dataTable({
            "sPaginationType": "full_numbers"
        });
    });
</script>
<script>
    /*
     * 加载*在职*员工信息列表方法：
     *
     * 传入值：
     *   部门id：department_id
     *   员工状态（在\离职）：status
     * 返回值：
     *   员工ID：id
     *   员工姓名：name
     *   员工工号：number
     *   员工手机号：phone
     *   员工所在部门：department
     *   员工职位：position
     *   员工班次：shift_id
     *   员工等级：level
     * */
    function getEmployee_on() {
        $.ajax({
            cache: false,
            type: "GET",
            url: "/getAttenceResult/",
            data: 'department_id=1&&status=1',
            dataType: 'json',
            async: false,
            error: function (request) {
                console.log(request.error);
            },
            success: function (data) {
                var html = "";
                for (var i = 0; i < data.length; i++) {
                    html += "<tr>";
                    for (attr in data[i]) {
                        html += "<td>";
                        html += data[i][attr];
                        html += "</td>";
                    }
                    html += "<td><span class=\"label label label-success\">在职</span></td>";
                    html += "</tr>";
                }
                //将拼接完成的table传入表格元素节点内
                $('#table_on').append(html);
            }
        });
    }

    /*
     * 加载*离职*员工信息列表方法：
     *
     * 传入值：
     *   部门id：department_id
     *   员工状态（在\离职）：status
     * 返回值：
     *   员工ID：id
     *   员工姓名：name
     *   员工工号：number
     *   员工手机号：phone
     *   员工所在部门：department
     *   员工职位：position
     *   员工班次：shift_id
     *   员工等级：level
     * */
    function getEmployee_off() {
        $.ajax({
            cache: true,
            type: "GET",
            url: "/getLeaveResult/",
            data: '',
            dataType: 'json',
            async: false,
            error: function (request) {
                console.log(request.error);
            },
            success: function (data) {
                var html = "";
                for (var i = 0; i < data.length; i++) {
                    html += "<tr>";
                    for (attr in data[i]) {
                        html += "<td>";
                        html += data[i][attr];
                        html += "</td>";
                    }
                    html += "<td><span class=\"label label label-important\">休假</span></td>";
                    html += "</tr>";
                }
                //将拼接完成的table传入表格元素节点内
                $('#table_off').append(html);
            }
        });
    }

    function lick(obj, id) {
        var td_content = $(obj).parents("tr").children("td");  //获取当前行中的所有td值

        var id = td_content.eq(0).text(); //获取当前行第二个td的值
        var name = td_content.eq(1).text(); //获取当前行第二个td的值
        var number = td_content.eq(2).text(); //获取当前行第二个td的值
        var phone = td_content.eq(3).text(); //获取当前行第二个td的值
        var department = td_content.eq(4).text(); //获取当前行第二个td的值
        var position = td_content.eq(5).text(); //获取当前行第二个td的值
        var shift_id = td_content.eq(6).text(); //获取当前行第二个td的值
        var level = td_content.eq(7).text(); //获取当前行第二个td的值

        document.getElementById('id').value = id;
        document.getElementById('name').value = name;
        document.getElementById('number').value = number;
        document.getElementById('phone').value = phone;
        document.getElementById('department').value = department;
        document.getElementById('position').value = position;
        document.getElementById('shift_id').value = shift_id;
        document.getElementById('level').value = level;
    }

    //编辑部门信息表单验证
    function edit() {
        //获取表单数据
        var employeeFormJson = $('#employeeForm').serializeArray();
        //构造请求参数
        var employeeSubmitJson = {
            id: parseInt(employeeFormJson[0].value),
            name: employeeFormJson[1].value,
            number: parseInt(employeeFormJson[2].value),
            phone: employeeFormJson[3].value,
            department: employeeFormJson[4].value,
            position: employeeFormJson[5].value,
            shift_id: parseInt(employeeFormJson[6].value),
            level: parseInt(employeeFormJson[7].value)
        };
        $.ajax({
            catch: false,
            type: "POST",
            url: "/attend/insert",
            data: employeeSubmitJson,
            async: false,
            success: function (data) {
                if (data == "SUCCESS") {
                    //打卡成功
                    message('success', '成功');
                } else if (data == "fail") {
                    //打卡失败
                    message('error', '失败');
                } else {
                    //其他错误信息
                    message('error', 'data');
                }
            }
        })
    }
</script>
</body>
</html>